<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');

        :root { 
            --neon: #00f2ff; 
            --physx-accent: #ff0055;
            --bg: #010204; 
            --panel: rgba(10, 14, 20, 0.98); 
            --border: #30363d; 
            --scroll-bg: #0a0e14;
            --scroll-thumb: #222;
        }
        
        * { box-sizing: border-box; font-family: 'JetBrains Mono', monospace; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: var(--neon); overflow: hidden; display: flex; height: 100vh; width: 100vw; flex-direction: row; }

        /* --- MOBILE RESPONSIVE SCROLLBARS --- */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: var(--scroll-bg); }
        ::-webkit-scrollbar-thumb { background: var(--scroll-thumb); border-radius: 10px; }

        /* --- LOADING SCREEN --- */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000; display: flex; flex-direction: column;
            align-items: center; justify-content: center; transition: opacity 0.8s ease;
        }
        .physx-logo { font-size: 12vw; font-weight: 700; letter-spacing: 15px; color: #fff; text-shadow: 0 0 20px var(--neon); }
        .progress-container { width: 70%; height: 2px; background: #111; margin-top: 30px; }
        .progress-bar { width: 0%; height: 100%; background: var(--neon); box-shadow: 0 0 15px var(--neon); }

        /* --- INTERFACE LAYOUT --- */
        #main-app { display: none; width: 100%; height: 100%; flex-direction: row; }
        
        #sidebar { 
            width: 350px; height: 100vh; background: var(--panel); 
            border-right: 1px solid var(--border); display: flex; 
            flex-direction: column; z-index: 100; transition: transform 0.3s ease;
        }

        /* --- MOBILE OVERRIDES --- */
        @media (max-width: 850px) {
            body { flex-direction: column; }
            #sidebar { 
                position: absolute; bottom: 0; left: 0; width: 100%; 
                height: 45%; border-right: none; border-top: 1px solid var(--border);
                transform: translateY(0);
            }
            #viewport { height: 55% !important; width: 100% !important; }
            .physx-logo { font-size: 45px; letter-spacing: 10px; }
        }

        .header { padding: 15px; border-bottom: 1px solid var(--border); background: linear-gradient(to right, #0a1420, transparent); }
        .header h2 { margin: 0; font-size: 14px; letter-spacing: 4px; color: #fff; }

        .scroll-area { flex-grow: 1; overflow-y: auto; padding: 12px; }
        .card { background: #080808; border: 1px solid #1a1a1a; padding: 12px; margin-bottom: 12px; border-left: 2px solid var(--border); }
        h3 { font-size: 9px; text-transform: uppercase; color: #5588ff; margin: 0 0 10px 0; border-left: 2px solid #5588ff; padding-left: 8px;}

        label { font-size: 8px; color: #555; display: block; margin-bottom: 4px; }
        input[type="number"], input[type="range"] { 
            width: 100%; background: #000; border: 1px solid #222; 
            color: #fff; padding: 8px; font-size: 11px; margin-bottom: 8px; outline: none;
        }
        
        .btn { 
            width: 100%; padding: 12px; background: transparent; 
            border: 1px solid var(--neon); color: var(--neon); 
            cursor: pointer; font-size: 10px; font-weight: bold; 
            text-transform: uppercase; margin-top: 5px;
        }

        table { width: 100%; border-collapse: collapse; font-size: 9px; margin-top: 5px; }
        th { text-align: left; color: #444; padding-bottom: 5px; border-bottom: 1px solid #111; }
        td input { padding: 4px !important; margin-bottom: 0 !important; }

        .telem-unit { background: rgba(0,0,0,0.3); padding: 8px; border: 1px solid #111; margin-bottom: 6px; border-left: 2px solid var(--physx-accent); }
        .stat-row { display: flex; justify-content: space-between; font-size: 9px; margin-bottom: 2px; }
        .stat-val { color: #fff; }

        #viewport { position: relative; flex-grow: 1; background: #000; overflow: hidden; }
        .physx-watermark { position: absolute; bottom: 20px; right: 20px; font-size: 10px; letter-spacing: 8px; opacity: 0.2; pointer-events: none; color: #04eafa; }
        .sys-clock { position: absolute; top: 15px; right: 15px; font-size: 9px; color: #444; }
    </style>
</head>
<body>

<div id="loader">
    <div class="physx-logo">PhysX</div>
    <div class="progress-container"><div class="progress-bar" id="bar"></div></div>
</div>

<div id="main-app">
    <div id="viewport">
        <div class="sys-clock" id="sys-clock">0.00s</div>
        <div class="physx-watermark">AARAV SINHA | PhysX</div>
        <canvas id="canvas"></canvas>
    </div>

    <div id="sidebar">
        <div class="header"><h2>PhysX<span>_MOBILE_LAB</span></h2></div>
        <div class="scroll-area">
            <div class="card">
                <h3>Global Kinematics</h3>
                <label>NODE QUANTITY</label>
                <input type="number" id="n_count" value="2" min="1" max="5" onchange="initSystem()">
                <label>FRICTION (CONSTANT)</label>
                <input type="range" id="fric_s" min="0" max="0.5" step="0.01" value="0.05">
                <label>GRAVITY: <span id="g_l">9.8</span></label>
                <input type="range" id="g_s" min="0" max="25" step="0.1" value="9.8">
                <button class="btn" onclick="toggleSim()" id="runBtn">HALT ENGINE</button>
            </div>

            <div class="card">
                <h3>Constraint Matrix</h3>
                <div style="overflow-x: auto;">
                    <table>
                        <thead><tr><th>#</th><th>LEN</th><th>ANG°</th><th>MASS</th></tr></thead>
                        <tbody id="bob_body"></tbody>
                    </table>
                </div>
                <button class="btn" style="border-color:#333; color:#555; margin-top:10px" onclick="syncAllToFirst()">Mirror Node 01</button>
            </div>

            <div class="card" id="telem_container">
                <h3>Live Telemetry</h3>
            </div>
        </div>
    </div>
</div>

<script>
const canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d');
let bobs = [], trail = [], isRunning = true, dragBob = null;
let sysTime = 0;

window.onload = () => {
    let p = 0;
    const boot = setInterval(() => {
        p += 5; document.getElementById('bar').style.width = p + "%";
        if (p >= 100) {
            clearInterval(boot);
            document.getElementById('loader').style.opacity = '0';
            document.getElementById('main-app').style.display = 'flex';
            handleResize(); initSystem(); draw();
            setTimeout(() => document.getElementById('loader').remove(), 1000);
        }
    }, 25);
};

function initSystem() {
    let n = parseInt(document.getElementById('n_count').value);
    const tbody = document.getElementById('bob_body');
    tbody.innerHTML = ''; bobs = []; trail = []; sysTime = 0;
    bobs.push({x: canvas.width/2, y: canvas.height * 0.2, fixed: true, mass: 0});
    for(let i=0; i<n; i++) {
        let l = Math.min(canvas.width, canvas.height) * 0.25;
        let m = 25, ang = 45 * Math.PI/180;
        bobs.push({
            x: bobs[i].x + l*Math.sin(ang), y: bobs[i].y + l*Math.cos(ang),
            oldX: bobs[i].x + l*Math.sin(ang), oldY: bobs[i].y + l*Math.cos(ang),
            len: l, mass: m, lastAng: ang, lastOmega: 0
        });
        tbody.innerHTML += `<tr><td>${i+1}</td>
            <td><input type="number" id="L${i}" value="${Math.round(l)}" oninput="syncFromTable()"></td>
            <td><input type="number" id="A${i}" value="45" oninput="syncFromTable()"></td>
            <td><input type="number" id="M${i}" value="${m}" oninput="syncFromTable()"></td></tr>`;
    }
}

function syncFromTable() {
    for(let i=1; i<bobs.length; i++) {
        let b = bobs[i], p = bobs[i-1];
        b.len = parseFloat(document.getElementById(`L${i-1}`).value);
        b.mass = parseFloat(document.getElementById(`M${i-1}`).value);
        let ang = parseFloat(document.getElementById(`A${i-1}`).value) * Math.PI/180;
        b.x = p.x + b.len * Math.sin(ang); b.y = p.y + b.len * Math.cos(ang);
        b.oldX = b.x; b.oldY = b.y;
    }
}

function syncAllToFirst() {
    const l = document.getElementById('L0').value, a = document.getElementById('A0').value, m = document.getElementById('M0').value;
    for(let i=1; i<bobs.length-1; i++) {
        document.getElementById(`L${i}`).value = l;
        document.getElementById(`A${i}`).value = a;
        document.getElementById(`M${i}`).value = m;
    }
    syncFromTable();
}

function solvePhysics() {
    const g = parseFloat(document.getElementById('g_s').value)/10;
    const friction = parseFloat(document.getElementById('fric_s').value);
    document.getElementById('g_l').innerText = (g*10).toFixed(1);

    if (isRunning && !dragBob) {
        sysTime += 1/60;
        for(let s=0; s<10; s++) {
            bobs.forEach(b => { if(!b.fixed) {
                let vx = (b.x-b.oldX), vy = (b.y-b.oldY);
                let speed = Math.hypot(vx, vy);
                if(speed > 0) {
                    let drop = Math.min(speed, friction/100);
                    vx -= (vx/speed) * drop;
                    vy -= (vy/speed) * drop;
                }
                b.oldX = b.x; b.oldY = b.y;
                b.x += vx; b.y += vy + g/100;
            }});
            for(let k=0; k<20; k++) {
                for(let i=1; i<bobs.length; i++) {
                    let p1 = bobs[i-1], p2 = bobs[i], dx = p2.x-p1.x, dy = p2.y-p1.y;
                    let dist = Math.sqrt(dx*dx+dy*dy), diff = (p2.len-dist)/dist;
                    if(!p1.fixed){ p1.x -= dx*diff*0.5; p1.y -= dy*diff*0.5; }
                    p2.x += dx*diff*0.5; p2.y += dy*diff*0.5;
                }
            }
        }
        trail.push({x: bobs[bobs.length-1].x, y: bobs[bobs.length-1].y});
        if(trail.length > 150) trail.shift();
    }
}

function updateAnalytics() {
    document.getElementById('sys-clock').innerText = `CLOCK: ${sysTime.toFixed(2)}s`;
    let html = '<h3>Live Telemetry</h3>';
    for(let i=1; i<bobs.length; i++) {
        let b = bobs[i], p = bobs[i-1];
        let ang = Math.atan2(b.x-p.x, b.y-p.y);
        let omega = (ang - b.lastAng) * 60;
        let alpha = (omega - b.lastOmega) * 60;
        b.lastAng = ang; b.lastOmega = omega;
        let vel = Math.hypot(b.x-b.oldX, b.y-b.oldY)*60;
        html += `<div class="telem-unit">
            <div class="stat-row"><b>NODE_0${i}</b><span>${(ang*180/Math.PI).toFixed(0)}°</span></div>
            <div class="stat-row"><span>ω VEL</span><span class="stat-val">${omega.toFixed(2)}</span></div>
            <div class="stat-row"><span>α ACC</span><span class="stat-val">${alpha.toFixed(2)}</span></div>
        </div>`;
    }
    document.getElementById('telem_container').innerHTML = html;
}

function draw() {
    ctx.fillStyle = '#000'; ctx.fillRect(0,0,canvas.width,canvas.height);
    solvePhysics();
    ctx.strokeStyle = '#080808'; ctx.beginPath();
    for(let i=0; i<canvas.width; i+=40){ctx.moveTo(i,0); ctx.lineTo(i,canvas.height);}
    for(let i=0; i<canvas.height; i+=40){ctx.moveTo(0,i); ctx.lineTo(canvas.width,i);}
    ctx.stroke();

    ctx.strokeStyle = 'rgba(255, 0, 85, 0.4)'; ctx.lineWidth = 2; ctx.beginPath();
    trail.forEach((p, i) => i === 0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y)); ctx.stroke();

    ctx.strokeStyle = '#fff'; ctx.setLineDash([5,5]); ctx.beginPath();
    ctx.moveTo(bobs[0].x, bobs[0].y); bobs.forEach(b => ctx.lineTo(b.x, b.y)); ctx.stroke();
    ctx.setLineDash([]);

    bobs.forEach((b, i) => {
        ctx.fillStyle = (dragBob===b) ? "#ff0055" : "#00f2ff";
        ctx.beginPath(); ctx.arc(b.x, b.y, b.fixed?4:Math.sqrt(b.mass)*2.2, 0, Math.PI*2); ctx.fill();
    });

    updateAnalytics();
    requestAnimationFrame(draw);
}

function handleResize() {
    if(window.innerWidth < 850) {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight * 0.55;
    } else {
        canvas.width = window.innerWidth - 350;
        canvas.height = window.innerHeight;
    }
}

const getPointerPos = (e) => {
    const rect = canvas.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    return { x: clientX - rect.left, y: clientY - rect.top };
};

const handleDown = (e) => {
    const pos = getPointerPos(e);
    bobs.forEach(b => { if(!b.fixed && Math.hypot(pos.x-b.x, pos.y-b.y) < 40) dragBob = b; });
};

const handleMove = (e) => {
    if(!dragBob) return;
    const pos = getPointerPos(e);
    dragBob.x = pos.x; dragBob.y = pos.y;
    dragBob.oldX = pos.x; dragBob.oldY = pos.y;
    for(let i=1; i<bobs.length; i++) {
        let dx = bobs[i].x-bobs[i-1].x, dy = bobs[i].y-bobs[i-1].y;
        bobs[i].len = Math.sqrt(dx*dx+dy*dy);
        let input = document.getElementById(`L${i-1}`);
        if(input) {
            input.value = Math.round(bobs[i].len);
            document.getElementById(`A${i-1}`).value = Math.round(Math.atan2(dx, dy) * 180/Math.PI);
        }
    }
};

canvas.addEventListener('mousedown', handleDown);
canvas.addEventListener('touchstart', handleDown, {passive: false});
window.addEventListener('mousemove', handleMove);
window.addEventListener('touchmove', handleMove, {passive: false});
window.addEventListener('mouseup', () => dragBob = null);
window.addEventListener('touchend', () => dragBob = null);
window.addEventListener('resize', () => { handleResize(); initSystem(); });

function toggleSim() { isRunning = !isRunning; document.getElementById('runBtn').innerText = isRunning ? "HALT ENGINE" : "RESTORE ENGINE"; }
</script>
</body>
</html>